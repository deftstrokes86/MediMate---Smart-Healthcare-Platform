
name: MediMate CI

on:
  pull_request:
    branches: [ main ]

jobs:
  test:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Set up Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '20'

    - name: Install Frontend Dependencies
      run: |
        cd frontend
        npm ci

    - name: Install Functions Dependencies
      run: |
        cd functions
        npm ci

    - name: Install Firebase CLI
      run: npm install -g firebase-tools

    - name: Run Firebase Emulator and Tests
      run: |
        # It's important to have a service account key for the test environment
        # This assumes you have it stored as a secret in GitHub
        # echo "${{ secrets.FIREBASE_SERVICE_ACCOUNT_KEY }}" > functions/service-account-key.json
        firebase emulators:exec --only auth,firestore,functions,storage "cd functions && npm test"
